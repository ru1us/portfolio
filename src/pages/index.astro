---
import Layout from "../layouts/Layout.astro";

const BASE_URL = import.meta.env.BASE_URL;
---

<Layout title="Portfolio — Overview">
  <!-- Hero Section - Full Width, 80% Height -->
  <section
    id="hero"
    class="w-full h-[80vh] flex flex-col justify-center mx-auto scroll-fade"
  >
    <!-- Header: Name & Title - Full Width -->
    <div class="w-full text-center mb-20">
      <h1 class="text-8xl font-heading font-bold mb-6">
        <span class="gradient-text">I'm Rufus</span>
        <span class="text-sm font-normal italic">(Latin: "red")</span>
      </h1>
      <!-- <h2 class="text-4xl mb-8">
        Red isn't just a color — it's my <span class="text-red-600">name.</span>
      </h2> -->
      <h2 class="text-4xl mb-8">
        I do <span class="text-red-600 typing-text"></span><span
          class="typing-cursor text-red-600">|</span
        >
      </h2>
      <h3 class="text-2xl font-heading font-light text-slate-500">
        Mediadesign Student (B.Sc.)
      </h3>
    </div>

    <!-- 4 Boxes in a Row - Full Width -->
    <div class="w-full grid grid-cols-4 gap-6">
      <!-- 1. Skills Box -->
      <div
        class="border border-slate-400 p-6 w-full h-full flex flex-col justify-start card-3d"
      >
        <h3 class="font-heading font-bold text-base mb-3 text-slate-900">
          Skills
        </h3>
        <ul class="text-sm text-slate-700 space-y-2">
          <li class="flex items-center">
            <span class="w-2 h-2 bg-red-600 rounded-full mr-3"></span>3D
            Modeling & Rendering
          </li>
          <li class="flex items-center">
            <span class="w-2 h-2 bg-red-600 rounded-full mr-3"></span>UI/UX
            Design
          </li>
          <li class="flex items-center">
            <span class="w-2 h-2 bg-red-600 rounded-full mr-3"></span>Graphic
            Design
          </li>
          <li class="flex items-center">
            <span class="w-2 h-2 bg-red-600 rounded-full mr-3"></span>Web
            Development
          </li>
        </ul>
      </div>

      <!-- 2. Tools Box -->
      <div
        class="border border-slate-400 p-6 w-full h-full flex flex-col justify-start card-3d"
      >
        <h3 class="font-heading font-bold text-base mb-3 text-slate-900">
          Tools
        </h3>
        <ul class="text-sm text-slate-700 space-y-2">
          <li class="flex items-center">
            <span class="w-2 h-2 bg-red-600 rounded-full mr-3"></span>Adobe CC
            (Ps, Ai, Id, Pr, Ae, ...)
          </li>
          <li class="flex items-center">
            <span class="w-2 h-2 bg-red-600 rounded-full mr-3"></span>Blender
          </li>
          <li class="flex items-center">
            <span class="w-2 h-2 bg-red-600 rounded-full mr-3"></span>SolidWorks
          </li>
          <li class="flex items-center">
            <span class="w-2 h-2 bg-red-600 rounded-full mr-3"></span>Java, JavaScript, HTML, CSS, Dart
          </li>
        </ul>
      </div>

      <!-- 3. About Me Box -->
      <div
        class="border border-slate-400 p-6 w-full h-full flex flex-col justify-start card-3d cursor-pointer hover:border-slate-500 transition-colors relative group"
        onclick={`window.location.href='${BASE_URL}about'`}
      >
        <!-- Arrow Icon -->
        <div class="absolute top-4 right-4 w-5 h-5 text-red-600">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="20px"
            viewBox="0 -960 960 960"
            width="20px"
            class="group-hover:scale-125 transition-transform"
            fill="currentColor"
          >
            <path d="m256-240-56-56 384-384H240v-80h480v480h-80v-344L256-240Z"
            ></path>
          </svg>
        </div>

        <h3 class="font-heading font-bold text-base mb-3 text-slate-900">
          About Me
        </h3>
        <p class="text-sm text-slate-700">
          Brief description about myself and my background.
        </p>
      </div>

      <!-- 4. All Projects Box -->
      <div
        class="border border-slate-400 p-6 w-full h-full flex flex-col justify-start card-3d cursor-pointer hover:border-slate-500 transition-colors relative group"
        onclick={`window.location.href='${BASE_URL}projects'`}
      >
        <!-- Arrow Icon -->
        <div class="absolute top-4 right-4 w-5 h-5 text-red-600">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="20px"
            viewBox="0 -960 960 960"
            width="20px"
            class="group-hover:scale-125 transition-transform"
            fill="currentColor"
          >
            <path d="m256-240-56-56 384-384H240v-80h480v480h-80v-344L256-240Z"
            ></path>
          </svg>
        </div>

        <h3 class="font-heading font-bold text-base mb-3 text-slate-900">
          All Projects
        </h3>
      </div>
    </div>
  </section>
  <!-- Case Study Section with Scroll-Sync Video -->
  <section id="case-study" class="py-16 scroll-fade">
    <div class="container mb-8">
      <h2 class="text-2xl font-semibold">Case Study — Project Name</h2>
    </div>
    
    <!-- Scroll-Sync Video Container - Full Width Container -->
    <div class="w-full overflow-hidden mb-12">
      <canvas
        id="scroll-canvas"
        class="w-full h-auto block"
        style="display: block; width: 100%; height: auto; background: transparent;"
      ></canvas>
      <video
        id="scroll-video"
        class="w-full h-auto block hidden"
        muted
        crossorigin="anonymous"
        preload="auto"
        style="display: none;"
      >
        <source src="/textures/Comp.mp4" type="video/mp4" />
        <source src="/textures/Comp.webm" type="video/webm" />
        Your browser does not support the video tag.
      </video>
    </div>
  </section>

  <!-- More Projects Section -->
  <section id="more-projects" class="py-16 scroll-fade">
    <div
      class="flex items-center gap-3 mb-8 cursor-pointer group"
      onclick={`window.location.href='${BASE_URL}projects'`}
    >
      <h2
        class="text-2xl font-heading font-semibold group-hover:text-red-600 transition-colors"
      >
        More Projects
      </h2>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6 text-red-600 group-hover:translate-x-3 transition-transform"
        viewBox="0 -960 960 960"
        fill="currentColor"
      >
        <path d="m256-240-56-56 384-384H240v-80h480v480h-80v-344L256-240Z"
        ></path>
      </svg>
    </div>
    <div class="grid grid-cols-3 gap-6">
      <!-- Project 1: FORMA -->
      <div
        class="border border-slate-400 hover:border-slate-500 transition-colors cursor-pointer group"
        onclick={`window.location.href='${BASE_URL}projects/forma'`}
      >
        <div class="w-full h-48 bg-slate-200 overflow-hidden">
          <img
            src={`${BASE_URL}projects/forma/chair1.webp`}
            alt="FORMA Furniture Collections"
            class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-300"
          />
        </div>
        <div class="p-4">
          <h3 class="font-heading font-bold text-base mb-2">
            FORMA — Furniture Collections
          </h3>
          <p class="text-sm text-slate-600 mb-3">
            Three distinct design philosophies in furniture
          </p>
          <div class="flex flex-wrap gap-2">
            <span class="bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded"
              >3D Design</span
            >
            <span class="bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded"
              >Furniture</span
            >
          </div>
        </div>
      </div>

      <!-- Project 2: KLAPP -->
      <div
        class="border border-slate-400 hover:border-slate-500 transition-colors cursor-pointer group"
        onclick={`window.location.href='${BASE_URL}projects/klapp-hairdryer'`}
      >
        <div class="w-full h-48 bg-slate-200 overflow-hidden">
          <img
            src={`${BASE_URL}projects/klapp/Aseite2.webp`}
            alt="KLAPP Product Design"
            class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-300"
          />
        </div>
        <div class="p-4">
          <h3 class="font-heading font-bold text-base mb-2">
            KLAPP — Product Design
          </h3>
          <p class="text-sm text-slate-600 mb-3">
            Innovative folding product design concept
          </p>
          <div class="flex flex-wrap gap-2">
            <span class="bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded"
              >Product Design</span
            >
            <span class="bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded"
              >3D Modeling</span
            >
          </div>
        </div>
      </div>

      <!-- Project 3: FoodDecode -->
      <div
        class="border border-slate-400 hover:border-slate-500 transition-colors cursor-pointer group"
        onclick={`window.location.href='${BASE_URL}projects/fooddecode-ux'`}
      >
        <div class="w-full h-48 bg-slate-200 overflow-hidden">
          <img
            src={`${BASE_URL}projects/UX/title.webp`}
            alt="FoodDecode UX/UI Design"
            class="w-full h-full object-cover object-center grayscale group-hover:grayscale-0 transition-all duration-300"
          />
        </div>
        <div class="p-4">
          <h3 class="font-heading font-bold text-base mb-2">
            FoodDecode — UX/UI Design
          </h3>
          <p class="text-sm text-slate-600 mb-3">
            Digital platform for transparent food choices
          </p>
          <div class="flex flex-wrap gap-2">
            <span class="bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded"
              >UX/UI</span
            >
            <span class="bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded"
              >User Research</span
            >
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>

<script>
  import gsap from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  // Card Tilt Effect - Only for Index Page
  class CardTiltEffect {
    cards: any[] = [];

    constructor() {
      this.init();
    }

    init() {
      const cardElements = document.querySelectorAll(".card-3d");

      cardElements.forEach((card) => {
        this.setupCard(card as HTMLElement);
      });
    }

    setupCard(cardElement: HTMLElement) {
      const cardData = {
        element: cardElement,
        maxTilt: 8, // Subtle effect
      };

      this.cards.push(cardData);

      // Add event listeners
      cardElement.addEventListener("mousemove", (e: MouseEvent) =>
        this.onMouseMove(e, cardData)
      );
      cardElement.addEventListener("mouseleave", (e: MouseEvent) =>
        this.onMouseLeave(e, cardData)
      );
    }

    onMouseMove(event: MouseEvent, cardData: any) {
      const card = cardData.element;
      const rect = card.getBoundingClientRect();

      // Calculate mouse position relative to card (0 to 1)
      const x = (event.clientX - rect.left) / rect.width;
      const y = (event.clientY - rect.top) / rect.height;

      // Convert to rotation values (-1 to 1, then to degrees)
      const rotateY = (x - 0.5) * 2 * cardData.maxTilt;
      const rotateX = (y - 0.5) * -2 * cardData.maxTilt;

      // Apply subtle rotation
      card.style.transform = `
        perspective(1000px) 
        rotateX(${rotateX}deg) 
        rotateY(${rotateY}deg) 
        scale3d(1.02, 1.02, 1.02)
      `;
    }

    onMouseLeave(event: MouseEvent, cardData: any) {
      // Return to original position
      cardData.element.style.transform = `
        perspective(1000px) 
        rotateX(0deg) 
        rotateY(0deg) 
        scale3d(1, 1, 1)
      `;
    }
  }

  // Typing Animation Effect
  class TypingAnimation {
    private element: HTMLElement;
    private words: string[];
    private currentWordIndex: number = 0;
    private currentText: string = "";
    private isDeleting: boolean = false;
    private typingSpeed: number = 100;
    private deletingSpeed: number = 50;
    private pauseDuration: number = 1500;

    constructor() {
      this.element = document.querySelector(".typing-text") as HTMLElement;
      this.words = [
        "3D Design",
        "UI/UX Design",
        "Brand Identity",
        "Product Design",
        "Web Design",
      ];
      if (this.element) {
        this.type();
      }
    }

    type() {
      const currentWord = this.words[this.currentWordIndex];

      if (this.isDeleting) {
        this.currentText = currentWord.substring(
          0,
          this.currentText.length - 1
        );
      } else {
        this.currentText = currentWord.substring(
          0,
          this.currentText.length + 1
        );
      }

      this.element.textContent = this.currentText;

      let speed = this.isDeleting ? this.deletingSpeed : this.typingSpeed;

      if (!this.isDeleting && this.currentText === currentWord) {
        speed = this.pauseDuration;
        this.isDeleting = true;
      } else if (this.isDeleting && this.currentText === "") {
        this.isDeleting = false;
        this.currentWordIndex = (this.currentWordIndex + 1) % this.words.length;
        speed = 500;
      }

      setTimeout(() => this.type(), speed);
    }
  }

  // Mouse-tracked Gradient Effect
  class MouseGradientEffect {
    private gradientText: HTMLElement;

    constructor() {
      this.gradientText = document.querySelector(
        ".gradient-text"
      ) as HTMLElement;
      if (this.gradientText) {
        this.init();
      }
    }

    init() {
      // Track mouse movement across the entire viewport
      document.addEventListener("mousemove", (e: MouseEvent) => {
        const mouseX = e.clientX;
        const windowWidth = window.innerWidth;

        // Map mouse position to a ratio (0 to 1)
        const ratio = mouseX / windowWidth;

        // Create a bell curve effect - maximum red at center (0.5), black at edges (0 and 1)
        // Using a parabolic function: intensity peaks at center
        let intensity;
        if (ratio <= 0.5) {
          // Left half: goes from 0 (at 0) to 1 (at 0.5)
          intensity = ratio * 2;
        } else {
          // Right half: goes from 1 (at 0.5) to 0 (at 1)
          intensity = 2 - ratio * 2;
        }

        // Square the intensity for sharper curve (more black, only center is red)
        intensity = Math.pow(intensity, 2);

        // Interpolate from black to red based on intensity
        const r = Math.round(220 * intensity);
        const g = Math.round(38 * intensity);
        const b = Math.round(38 * intensity);

        this.gradientText.style.color = `rgb(${r}, ${g}, ${b})`;
      });

      // Reset to black on mouse leave
      document.addEventListener("mouseleave", () => {
        this.gradientText.style.color = "#000000";
      });
    }
  }

  // Initialize when DOM is loaded
  document.addEventListener("DOMContentLoaded", () => {
    new CardTiltEffect();
    new MouseGradientEffect();
    new TypingAnimation();
    
    // Initialize GSAP ScrollTrigger for video with Canvas rendering
    gsap.registerPlugin(ScrollTrigger);
    
    const video = document.getElementById("scroll-video") as HTMLVideoElement;
    const canvas = document.getElementById("scroll-canvas") as HTMLCanvasElement;
    
    if (video && canvas) {
      const ctx = canvas.getContext("2d");
      if (!ctx) return;
      
      let animationFrameId: number;
      
      // Wait for video to load
      video.addEventListener("loadedmetadata", () => {
        console.log("Video duration:", video.duration);
        
        // Set canvas size to match video
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        // Draw initial frame
        const drawFrame = () => {
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        };
        
        // GSAP ScrollTrigger with canvas rendering
        let targetTime = 0;
        let currentTime = 0;
        
        ScrollTrigger.create({
          trigger: canvas,
          start: "top bottom",
          end: "center center", // Video endet wenn Canvas die Mitte erreicht
          scrub: 0.5,
          onUpdate: (self) => {
            targetTime = self.progress * video.duration;
          }
        });
        
        // Smooth animation loop
        const animate = () => {
          // Smooth interpolation - sehr aggressiv für maximale Smoothness
          const diff = targetTime - currentTime;
          currentTime += diff * 0.08; // Reduziert von 0.15 für smoothere Bewegung
          
          // Seek nur bei größeren Unterschieden
          if (Math.abs(video.currentTime - currentTime) > 0.016) { // ~1 frame
            video.currentTime = currentTime;
          }
          
          // Always draw the current frame
          drawFrame();
          
          animationFrameId = requestAnimationFrame(animate);
        };
        
        // Start animation loop
        animate();
        
        console.log("Canvas-based scroll video initialized!");
      });
      
      video.load();
    }
  });

</script>
